<div class="file-manager-enhanced">
  <!-- Top Toolbar with Workspace Selector -->
  <div class="toolbar">
    <div class="toolbar-left">
      <div class="workspace-selector" (click)="showWorkspaceMenu = !showWorkspaceMenu">
        <span class="workspace-icon">{{ activeWorkspace?.icon || 'üìÅ' }}</span>
        <span class="workspace-name">{{ activeWorkspace?.name || 'Default' }}</span>
        <span class="workspace-arrow">‚ñº</span>
      </div>

      <!-- Workspace Dropdown Menu -->
      <div class="workspace-menu" *ngIf="showWorkspaceMenu">
        <div class="workspace-menu-header">
          <h3>Workspaces</h3>
          <button (click)="createNewWorkspace()" class="btn-icon">‚ûï</button>
        </div>
        <div class="workspace-list">
          <div 
            *ngFor="let workspace of workspaceList"
            class="workspace-item"
            [class.active]="workspace.id === activeWorkspace?.id"
            (click)="switchWorkspace(workspace.id)"
          >
            <span class="workspace-icon">{{ workspace.icon }}</span>
            <span class="workspace-name">{{ workspace.name }}</span>
          </div>
        </div>
        <div class="workspace-menu-footer">
          <button (click)="renameCurrentWorkspace()" class="btn-small">Rename</button>
          <button (click)="deleteCurrentWorkspace()" class="btn-small btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <div class="toolbar-center">
      <h1>File Manager</h1>
    </div>

    <div class="toolbar-right">
      <button (click)="toggleShowHidden()" [class.active]="showHidden" class="btn">
        {{ showHidden ? 'Hide' : 'Show' }} Hidden
      </button>
      <button (click)="theme.toggleTheme()" class="btn" title="Toggle theme">
        Theme
      </button>
      <button (click)="theme.toggleCompact()" [class.active]="(theme.getCompact$() | async)" class="btn" title="Toggle compact UI">
        Compact
      </button>
    </div>
  </div>

  <!-- Main Panes Container -->
  <div class="panes-container">
    <!-- Left Pane -->
    <div class="pane">
      <!-- Tab Bar -->
      <div class="tab-bar">
        <div class="tabs">
          <div 
            *ngFor="let tab of getTabs('left')"
            class="tab"
            [class.active]="tab.isActive"
            [class.pinned]="tab.isPinned"
            (click)="switchTab(leftPane, tab.id)"
          >
            <span class="tab-icon">üìÅ</span>
            <span class="tab-title">{{ tab.title }}</span>
            <button 
              *ngIf="tab.isPinned" 
              class="tab-pin"
              (click)="toggleTabPin(leftPane, tab.id, $event)"
              title="Unpin tab"
              aria-label="Unpin tab"
            ></button>
            <button 
              *ngIf="!tab.isPinned" 
              class="tab-close"
              (click)="closeTab(leftPane, tab.id); $event.stopPropagation()"
              title="Close tab"
              aria-label="Close tab"
            ></button>
          </div>
          <button class="tab-new" (click)="addTab(leftPane)" title="New tab">
          </button>
        </div>
      </div>

      <!-- Address Bar -->
      <app-address-bar-autocomplete
        [initialPath]="leftPane.currentPath"
        [paneId]="'left'"
        [placeholder]="'Enter path...'"
        (pathChange)="navigateFromAddressBar(leftPane, $event)"
        (navigateUp)="navigateToParent(leftPane)"
        (refresh)="refresh(leftPane)"
      ></app-address-bar-autocomplete>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <input 
          type="text"
          [(ngModel)]="leftPane.filterText"
          (ngModelChange)="onFilterChange(leftPane)"
          class="filter-input"
          placeholder="Filter: name, ext:pdf, type:dir, size>1mb..."
        />
        <button 
          *ngIf="leftPane.filterText"
          (click)="clearFilter(leftPane)" 
          class="btn-icon"
          title="Clear filter"
        >
          ‚úï
        </button>
        <span class="filter-count" *ngIf="leftPane.filterText">
          {{ leftPane.filteredEntries.length }} / {{ leftPane.entries.length }}
        </span>
      </div>

      <!-- Action Bar -->
      <div class="action-bar">
        <button (click)="createNewFolder(leftPane)" class="btn-small">‚ûï Folder</button>
        <button (click)="deleteSelected(leftPane)" [disabled]="leftPane.selectedFiles.size === 0" class="btn-small">
          üóëÔ∏è Delete ({{ leftPane.selectedFiles.size }})
        </button>
        <button (click)="copyToOtherPane(leftPane, rightPane)" [disabled]="leftPane.selectedFiles.size === 0" class="btn-small">
          ‚û°Ô∏è Copy ‚Üí
        </button>
        <button (click)="moveToOtherPane(leftPane, rightPane)" [disabled]="leftPane.selectedFiles.size === 0" class="btn-small">
          ‚û°Ô∏è Move ‚Üí
        </button>
      </div>

      <!-- File List -->
      <div class="pane-content">
        <div *ngIf="leftPane.loading" class="loading">Loading...</div>
        <div *ngIf="leftPane.error" class="error">{{ leftPane.error }}</div>
        
        <div *ngIf="!leftPane.loading && !leftPane.error" class="file-list">
          <div 
            *ngFor="let entry of leftPane.filteredEntries"
            class="file-entry"
            [class.selected]="isSelected(leftPane, entry)"
            [class.directory]="entry.type === FileType.DIRECTORY"
            (click)="toggleSelection(leftPane, entry)"
            (dblclick)="navigateToPath(leftPane, entry)"
          >
            <span class="file-icon">{{ getFileIcon(entry) }}</span>
            <div class="file-info">
              <div class="file-name">{{ entry.name }}</div>
              <div class="file-details">
                <span class="file-size">{{ formatSize(entry.size) }}</span>
                <span class="file-date">{{ formatDate(entry.modified) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Pane -->
    <div class="pane">
      <!-- Tab Bar -->
      <div class="tab-bar">
        <div class="tabs">
          <div 
            *ngFor="let tab of getTabs('right')"
            class="tab"
            [class.active]="tab.isActive"
            [class.pinned]="tab.isPinned"
            (click)="switchTab(rightPane, tab.id)"
          >
            <span class="tab-icon">üìÅ</span>
            <span class="tab-title">{{ tab.title }}</span>
            <button 
              *ngIf="tab.isPinned" 
              class="tab-pin"
              (click)="toggleTabPin(rightPane, tab.id, $event)"
              title="Unpin tab"
              aria-label="Unpin tab"
            ></button>
            <button 
              *ngIf="!tab.isPinned" 
              class="tab-close"
              (click)="closeTab(rightPane, tab.id); $event.stopPropagation()"
              title="Close tab"
              aria-label="Close tab"
            ></button>
          </div>
          <button class="tab-new" (click)="addTab(rightPane)" title="New tab">
          </button>
        </div>
      </div>

      <!-- Address Bar -->
      <app-address-bar-autocomplete
        [initialPath]="rightPane.currentPath"
        [paneId]="'right'"
        [placeholder]="'Enter path...'"
        (pathChange)="navigateFromAddressBar(rightPane, $event)"
        (navigateUp)="navigateToParent(rightPane)"
        (refresh)="refresh(rightPane)"
      ></app-address-bar-autocomplete>

      <!-- Filter Bar -->
      <div class="filter-bar">
        <input 
          type="text"
          [(ngModel)]="rightPane.filterText"
          (ngModelChange)="onFilterChange(rightPane)"
          class="filter-input"
          placeholder="Filter: name, ext:pdf, type:dir, size>1mb..."
        />
        <button 
          *ngIf="rightPane.filterText"
          (click)="clearFilter(rightPane)" 
          class="btn-icon"
          title="Clear filter"
        >
          ‚úï
        </button>
        <span class="filter-count" *ngIf="rightPane.filterText">
          {{ rightPane.filteredEntries.length }} / {{ rightPane.entries.length }}
        </span>
      </div>

      <!-- Action Bar -->
      <div class="action-bar">
        <button (click)="copyToOtherPane(rightPane, leftPane)" [disabled]="rightPane.selectedFiles.size === 0" class="btn-small">
          ‚¨ÖÔ∏è Copy ‚Üê
        </button>
        <button (click)="moveToOtherPane(rightPane, leftPane)" [disabled]="rightPane.selectedFiles.size === 0" class="btn-small">
          ‚¨ÖÔ∏è Move ‚Üê
        </button>
        <button (click)="deleteSelected(rightPane)" [disabled]="rightPane.selectedFiles.size === 0" class="btn-small">
          üóëÔ∏è Delete ({{ rightPane.selectedFiles.size }})
        </button>
        <button (click)="createNewFolder(rightPane)" class="btn-small">‚ûï Folder</button>
      </div>

      <!-- File List -->
      <div class="pane-content">
        <div *ngIf="rightPane.loading" class="loading">Loading...</div>
        <div *ngIf="rightPane.error" class="error">{{ rightPane.error }}</div>
        
        <div *ngIf="!rightPane.loading && !rightPane.error" class="file-list">
          <div 
            *ngFor="let entry of rightPane.filteredEntries"
            class="file-entry"
            [class.selected]="isSelected(rightPane, entry)"
            [class.directory]="entry.type === FileType.DIRECTORY"
            (click)="toggleSelection(rightPane, entry)"
            (dblclick)="navigateToPath(rightPane, entry)"
          >
            <span class="file-icon">{{ getFileIcon(entry) }}</span>
            <div class="file-info">
              <div class="file-name">{{ entry.name }}</div>
              <div class="file-details">
                <span class="file-size">{{ formatSize(entry.size) }}</span>
                <span class="file-date">{{ formatDate(entry.modified) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-path-history-viewer></app-path-history-viewer>
  
  <app-global-search 
    (resultSelected)="onGlobalSearchResult($event)">
  </app-global-search>

  <app-keyboard-help></app-keyboard-help>
</div>
